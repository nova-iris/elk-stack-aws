# Ansible Configuration for ELK Stack

This directory contains Ansible playbooks and roles for configuring the Elastic Stack components on AWS EC2 instances.

## Directory Structure

```
ansible/
├── install-elk.yml         # Main playbook
├── inventory/              # Server inventories
└── roles/                  # Component roles
    ├── elasticsearch/      # Elasticsearch config
    ├── elasticsearch_s3_backup/ # S3 backup config 
    ├── kibana/             # Kibana config
    ├── logstash/           # Logstash config
    └── filebeat/           # Filebeat config
```

## Manual Deployment

### 1. Prepare Inventory

```bash
cd /d/repos/nova-iris/elk-stack-setup/ansible
# Edit inventory/elk.ini with your server IPs if not generated by Terraform
```

### 2. Deploy Components

```bash
# Full stack deployment
ansible-playbook install-elk.yml

# Specific components only
ansible-playbook install-elk.yml -t elasticsearch,kibana

# S3 backup only
ansible-playbook install-elk.yml -t s3_backup
```

## Advanced Options

```bash
# Specify SSH key
ansible-playbook install-elk.yml --private-key=/path/to/key.pem

# Dry run (check mode)
ansible-playbook install-elk.yml --check

# Debug mode
ansible-playbook install-elk.yml -vvv

# Target specific hosts
ansible-playbook install-elk.yml -l elasticsearch_master
```

## Configuration Customization

Edit role defaults to customize configurations:

```bash
# Elasticsearch settings
vim roles/elasticsearch/defaults/main.yml

# S3 backup settings
vim roles/elasticsearch_s3_backup/defaults/main.yml
```

## Verify Deployment

```bash
# Get Elasticsearch password
ssh ubuntu@<elasticsearch_master_ip> 'sudo cat /etc/elasticsearch/elastic_credentials.txt'

# Check cluster health
curl -k -u elastic:PASSWORD https://<elasticsearch_master_ip>:9200/_cluster/health
```

## Troubleshooting

```bash
# Check connectivity
ansible -i inventory/elk.ini all -m ping

# View logs
ssh ubuntu@<elasticsearch_ip> 'sudo tail -f /var/log/elasticsearch/elasticsearch.log'
```